(this["webpackJsonpfluid-sim-video-music-visualizer"]=this["webpackJsonpfluid-sim-video-music-visualizer"]||[]).push([[0],{17:function(e){e.exports=JSON.parse('[{"source":"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4","title":"Big Buck Bunny"},{"source":"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4","title":"Elephant Dream"},{"source":"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4","title":"Sintel"},{"source":"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4","title":"Tears of Steel"}]')},22:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var a=n(3),i=n.n(a),o=n(16),r=n.n(o),c=(n(22),n(14)),s=n(8),u=n(2),l=n.n(u),d=n(10),v=n(4),f=n(7),h=n(11),m=n(12),p=n(15),g=n(13),x=n(1),b=n(0),j=function(e){Object(p.a)(n,e);var t=Object(g.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).props=void 0,a.frame=0,a.rectangle=null,a.audio=null,a.buffers=null,a.simulationProgram=null,a.shadeProgram=null,a.fftTexture=null,a.videoTexture=null,a.uniforms={},a.mousePos={x:0,y:0,z:0},a.props=e,a}return Object(m.a)(n,[{key:"Start",value:function(e){e.canvas.width=document.documentElement.clientWidth,e.canvas.height=document.documentElement.clientHeight,this.rectangle=x.b(e,{position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]}),this.buffers=[];for(var t=0;t<2;t++)this.buffers[t]=x.c(e,[{format:e.RED,internalFormat:e.R16F,type:e.FLOAT,mag:e.LINEAR,min:e.LINEAR,wrap:e.REPEAT}],e.canvas.width,e.canvas.height);var n="\n      attribute vec4 position;\n      void main() {\n        gl_Position = position;\n      }\n    ",a="\n      precision highp float;\n      #define texture texture2D\n      \n      uniform float iTime;\n      uniform vec2 iResolution;\n      uniform sampler2D video_tex;\n      uniform sampler2D fft_tex;\n      uniform vec3 iMouse;\n    ";this.simulationProgram=x.d(e,[n,"".concat(a,"\n            uniform sampler2D iChannel0;\n            uniform int iFrame;\n            ").concat(this.props.simulation,"\n          ")],(function(e,t){if(e)throw new Error(e)})),this.shadeProgram=x.d(e,[n,"".concat(a,"\n            uniform sampler2D iChannel0;\n            ").concat(this.props.shade,"\n            ")],(function(e,t){if(e)throw new Error(e)})),this.videoTexture||(this.videoTexture=x.e(e,{min:e.LINEAR,mag:e.LINEAR,wrap:e.REPEAT}),this.uniforms.video_tex=this.videoTexture),this.fftTexture||(this.fftTexture=x.e(e,{min:e.LINEAR,wrap:e.REPEAT}),this.uniforms.fft_tex=this.fftTexture),this.SetupMouse(e),this.props.onLoad(this)}},{key:"UpdateTexture",value:function(e){var t=this.glContext;t.bindTexture(t.TEXTURE_2D,this.videoTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,e)}},{key:"UpdateFFT",value:function(e){var t=this.glContext;t.bindTexture(t.TEXTURE_2D,this.fftTexture),t.texImage2D(t.TEXTURE_2D,0,t.R32F,e.length,1,0,t.RED,t.FLOAT,e)}},{key:"SetupMouse",value:function(e){var t=this;this.mousePos={x:0,y:0,z:0};var n=function(e,t,n){var a=function(e,t,n){var a=n.getBoundingClientRect();return{x:e-a.left,y:e-a.top}}(e,0,n);return a.x=a.x*n.width/n.clientWidth,a.y=a.y*n.height/n.clientHeight,a},a=e.canvas;a.onmousemove=function(a){t.mousePos=Object(f.a)({z:a.buttons},n(a.clientX,a.clientY,e.canvas))},a.onmousedown=function(a){t.mousePos=Object(f.a)({z:a.buttons},n(a.clientX,a.clientY,e.canvas))},a.ontouchmove=function(a){var i=a.touches.item(0);i&&(t.mousePos=Object(f.a)({z:1},n(i.clientX,i.clientY,e.canvas)))},a.ontouchstart=function(a){var i=a.touches.item(0);i&&(t.mousePos=Object(f.a)({z:1},n(i.clientX,i.clientY,e.canvas)))},a.onmouseup=function(){t.mousePos.z=0},a.ontouchend=function(){t.mousePos.z=0},a.ontouchcancel=function(){t.mousePos.z=0}}},{key:"PreDraw",value:function(){}},{key:"Draw",value:function(e,t){var n=e.canvas;if(x.g(n))for(var a=0;a<2;a++)x.h(e,this.buffers[a]);this.PreDraw();var i=this.uniforms;i.iResolution=[e.canvas.width,e.canvas.height],i.iFrame=this.frame,i.iMouse=[this.mousePos.x,-this.mousePos.y+e.canvas.height,this.mousePos.z],i.iTime=.0015*t,i.iChannel0=this.buffers[1].attachments[0],e.bindFramebuffer(e.FRAMEBUFFER,this.buffers[0].framebuffer),e.viewport(0,0,e.canvas.width,e.canvas.height),e.useProgram(this.simulationProgram.program),x.i(e,this.simulationProgram,this.rectangle),x.j(this.simulationProgram,this.uniforms),x.f(e,this.rectangle),e.bindFramebuffer(e.FRAMEBUFFER,null);var o=[this.buffers[1],this.buffers[0]];this.buffers[0]=o[0],this.buffers[1]=o[1],this.frame=this.frame+1,i.iChannel0=this.buffers[1].attachments[0],e.viewport(0,0,e.canvas.width,e.canvas.height),e.useProgram(this.shadeProgram.program),x.i(e,this.shadeProgram,this.rectangle),x.j(this.shadeProgram,this.uniforms),x.f(e,this.rectangle)}}]),n}(function(e){Object(p.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).glContext=null,e}return Object(m.a)(n,[{key:"Start",value:function(e){}},{key:"Draw",value:function(e,t){}},{key:"componentDidMount",value:function(){var e=this;x.a(this.glContext);requestAnimationFrame((function t(n){e.glContext&&(e.Draw(e.glContext,n),requestAnimationFrame(t))})),this.Start(this.glContext),window.addEventListener("resize",(function(){e.glContext&&e.Start(e.glContext)}))}},{key:"componentWillUnmount",value:function(){this.glContext=null}},{key:"render",value:function(){var e=this;return Object(b.jsx)("canvas",{ref:function(t){if(t){var n=t.getContext("webgl2");if(!n)throw new Error("unable to get webgl2 rendering context from canvas");e.glContext=n}}})}}]),n}(i.a.Component)),y=n(17),O=null,w=null,k=null,E=function(){O||(O=new AudioContext({latencyHint:"interactive"}),(w=O.createAnalyser()).smoothingTimeConstant=0,w.fftSize=2048,k=new Float32Array(w.frequencyBinCount))},P=new Map,T="none",C=function(){var e=Object(v.a)(l.a.mark((function e(t){var n,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=P.get(t)){e.next=3;break}return e.abrupt("return");case 3:a=Object(d.a)(n.mediaStream.getTracks());try{for(a.s();!(i=a.n()).done;)i.value.stop()}catch(o){a.e(o)}finally{a.f()}n.disconnect(),P.delete(t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=Object(v.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!1,audio:{deviceId:t,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,channelCount:2,latency:.02}});case 2:n=e.sent,(a=O.createMediaStreamSource(n)).connect(w),a.connect(O.destination),P.set(t,a),console.log("started listening to "+t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=new WeakMap,D=function(){var e=document.getElementById("videoPlayer");if(e&&(E(),!I.get(e))){var t=O.createMediaElementSource(e);I.set(e,t),t.connect(w),t.connect(O.destination)}},R=null,S=function(){var e=Object(v.a)(l.a.mark((function e(t){var n,a,i,o,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById("videoPlayer")){e.next=3;break}return e.abrupt("return");case 3:if(E(),R){a=Object(d.a)(R.getTracks());try{for(a.s();!(i=a.n()).done;)i.value.stop()}catch(u){a.e(u)}finally{a.f()}n.srcObject=null}if("desktop"!==t){e.next=15;break}return e.next=8,navigator.mediaDevices.getDisplayMedia({video:!0,audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,channelCount:2,latency:.02}});case 8:(o=e.sent).getAudioTracks().length>0&&((r=O.createMediaStreamSource(o)).connect(w),r.connect(O.destination)),R=o,c=new MediaStream(Object(s.a)(o.getVideoTracks())),n.srcObject=c,e.next=26;break;case 15:if("none"!==t){e.next=19;break}n.src="",e.next=26;break;case 19:if(!t.startsWith("http")){e.next=23;break}n.src=t,e.next=26;break;case 23:return e.next=25,navigator.mediaDevices.getUserMedia({video:{deviceId:t},audio:!1});case 25:n.srcObject=e.sent;case 26:T=t;case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var M=function(){var e=Object(a.useRef)(null),t=Object(a.useState)([]),n=Object(c.a)(t,2),i=n[0],o=n[1],r=Object(a.useState)({}),s=Object(c.a)(r,2)[1];return Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)(j,{onLoad:function(t){e.current=t;var n=document.getElementById("videoPlayer");n&&(t.PreDraw=function(){w&&(w.getFloatTimeDomainData(k),t.UpdateFFT(k)),n.readyState>=2&&t.UpdateTexture(n)})},simulation:"\n                    #define FFT(f) texture(fft_tex, vec2(f, 0.0)).x\n                    #define PIXEL(x, y) texture(iChannel0, uv + vec2(x, y) / iResolution.xy).r\n\n                    void mainImage(out vec4 out_color, in vec2 coordinates)\n                    {    \n                        vec2 uv = coordinates.xy / iResolution.xy;                  \n                        \n                        float v = PIXEL(0.0, 0.0);\n                        v = PIXEL(\n                            sin(PIXEL(v, 0.0)  - PIXEL(-v, 0.0) + 3.1415) * v * 0.4, \n                            cos(PIXEL(0.0, -v) - PIXEL(0.0 , v) - 1.57) * v * 0.4\n                        );\n                        v += pow(FFT(pow(v*0.1, 1.5) * 0.25) * 1.5, 3.0);\n                        v -= pow(length(texture(video_tex, uv * vec2(1.0, -1.0))) + 0.05, 3.0) * 0.08;\n                        v *= 0.925 + FFT(v)*0.1;\n\n                        if (iMouse.z > 0.0) {\n                            v += smoothstep(100.0, 0.5, length(iMouse.xy - coordinates)) * 0.05;\n                        }\n                        \n                        out_color.r = v;\n                    }\n\n                    void main() { mainImage(gl_FragColor, gl_FragCoord.xy); }\n                    ",shade:"\n                    void mainImage( out vec4 out_color, in vec2 coordinates )\n                    {\n                        vec2 uv = coordinates.xy/iResolution.xy;\n                        float v = texture(iChannel0, uv).r * 1.5;\n                            \n                        vec3 color = pow(vec3(cos(v), tan(v), sin(v)) * 0.5 + 0.5, vec3(0.5));\n                        vec3 e = vec3(vec2(1.0) / iResolution.xy, 0.0);\n                        vec3 grad = normalize(vec3(\n                            texture(iChannel0, uv + e.xz).x - texture(iChannel0, uv - e.xz).x, \n                            texture(iChannel0, uv + e.zy).x - texture(iChannel0, uv - e.zy).x, 1.0));\n                        vec3 light = vec3(0.26, -0.32, 0.91);\n                        float diffuse = dot(grad, light);\n                        float spec = pow(max(0.0, -reflect(light, grad).z), 32.0);\n                        \n                        out_color.rgb = (color * diffuse) + spec;\n                        out_color.a = 1.0;\n                    }\n\n                    void main() { mainImage(gl_FragColor, gl_FragCoord.xy); }\n                    "}),Object(b.jsxs)("div",{style:{margin:30},children:[Object(b.jsx)("h2",{children:"audio and video input"}),Object(b.jsx)("ul",{children:Object(b.jsxs)("select",{value:T,onChange:function(){var e=Object(v.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(t.currentTarget.value);case 2:return e.next=4,D();case 4:s({});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[Object(b.jsx)("option",{value:"none",children:"None"},"none"),Object(b.jsx)("option",{disabled:!0,children:"\u2500\u2500 input devices \u2500\u2500"}),Object(b.jsx)("option",{value:"desktop",children:"Desktop"},"desktop"),i.map((function(e){return"videoinput"===e.kind?Object(b.jsx)("option",{value:e.deviceId,children:e.label||"unknown device: "+e.deviceId},e.deviceId):null})),Object(b.jsx)("option",{disabled:!0,children:"\u2500\u2500 sample videos \u2500\u2500"}),y.map((function(e){return Object(b.jsx)("option",{value:e.source,children:e.title},e.source)}))]})}),Object(b.jsx)("h2",{children:"extra audio input"}),Object(b.jsxs)("ul",{children:[0===i.length?Object(b.jsx)("button",{onClick:Object(v.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:return e.prev=7,e.next=10,navigator.mediaDevices.getUserMedia({video:!0});case 10:e.next=14;break;case 12:e.prev=12,e.t1=e.catch(7);case 14:return e.t2=o,e.next=17,navigator.mediaDevices.enumerateDevices();case 17:e.t3=e.sent,(0,e.t2)(e.t3);case 19:case"end":return e.stop()}}),e,null,[[0,5],[7,12]])}))),children:"request access"}):null,i.map((function(e){return"audioinput"===e.kind?Object(b.jsxs)("li",{children:[Object(b.jsx)("input",{title:e.label||"unknown device: "+e.deviceId,type:"checkbox",checked:P.has(e.deviceId),onChange:function(){var t=Object(v.a)(l.a.mark((function t(n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(E(),!P.has(e.deviceId)){t.next=6;break}return t.next=4,C(e.deviceId);case 4:t.next=8;break;case 6:return t.next=8,F(e.deviceId);case 8:s({});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),Object(b.jsx)("span",{children:e.label})]},e.deviceId):null}))]}),Object(b.jsx)("h2",{children:"video player"}),Object(b.jsx)("video",{id:"videoPlayer",style:{width:512},controls:!0,crossOrigin:"anonymous",src:"",autoPlay:!0},"videoplayer"),Object(b.jsx)("h2",{children:"extra audio player"}),Object(b.jsx)("input",{type:"file",id:"upload",onChange:function(e){var t=e.target.files;if(t){var n=document.getElementById("audioplayer");if(n){n.src=URL.createObjectURL(t[0]),E();var a=O.createMediaElementSource(n);I.set(n,a),a.connect(w),a.connect(O.destination)}}}}),Object(b.jsx)("audio",{loop:!0,id:"audioplayer",style:{width:512},controls:!0,crossOrigin:"anonymous",src:"",autoPlay:!0},"audioplayer")]})]})},z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,26)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),a(e),i(e),o(e),r(e)}))};r.a.render(Object(b.jsx)(i.a.StrictMode,{children:Object(b.jsx)(M,{})}),document.getElementById("root")),z()}},[[25,1,2]]]);
//# sourceMappingURL=main.647bbb44.chunk.js.map